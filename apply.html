<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="description" content="Apply for fast-reply job matches at GuideSignal. Get matched with employers who respond within 48 hours. Free application process.">
<meta name="keywords" content="job application, fast reply jobs, apply for jobs, job matching">
<meta name="robots" content="index, follow">
<link rel="canonical" href="https://guide-signal.com/apply.html">
<title>Apply for Fast-Reply Job Matches - GuideSignal</title>
<style>
  body{margin:0;background:#F7F9FC;font:15px system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial,sans-serif}
  main{max-width:760px;margin:24px auto;padding:0 16px}
  .card{background:#fff;border:1px solid #e5eaf1;border-radius:16px;padding:22px;box-shadow:0 6px 20px rgba(2,8,23,.06)}
  label{display:block;margin:12px 0 6px}
  input,textarea,select{width:100%;padding:12px;border-radius:10px;border:1px solid #dbe1ea;box-sizing:border-box}
  select{-webkit-appearance:none;-moz-appearance:none;appearance:none;background-image:url("data:image/svg+xml;charset=UTF-8,%3csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='none' stroke='currentColor' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3e%3cpolyline points='6,9 12,15 18,9'%3e%3c/polyline%3e%3c/svg%3e");background-repeat:no-repeat;background-position:right 12px center;background-size:16px;padding-right:40px}
  @media (max-width: 480px) {
    main{padding:0 12px}
    .card{padding:16px}
    input,textarea,select{font-size:16px}
  }
  button{margin-top:12px;padding:12px 16px;border-radius:12px;border:1px solid #0F172A;background:#0F172A;color:#fff;font-weight:700}
  small{color:#64748b}
  .targeting-banner{background:#e3f2fd;border:1px solid #4a9eff;border-radius:8px;padding:12px;margin-bottom:16px;color:#1976d2;font-size:14px;text-align:center}
</style>
</head>
<body>
<main>
  <div style="text-align:center;margin-bottom:20px">
    <a href="index.html" style="color:#4a9eff;text-decoration:none;margin-right:20px">← Home</a>
    <a href="jobs.html" style="color:#4a9eff;text-decoration:none;margin-right:20px">Fast-Reply Jobs</a>
    <a href="how.html" style="color:#4a9eff;text-decoration:none;margin-right:20px">How it Works</a>
    <a href="faq.html" style="color:#4a9eff;text-decoration:none">FAQ</a>
  </div>
  <!-- Authentication required message -->
  <div id="auth-required" class="card" style="display: none; text-align: center;">
    <h2>Please Sign In</h2>
    <p>You need to create an account or sign in to apply for jobs.</p>
    <a href="auth.html" style="background: #4a9eff; color: white; padding: 12px 24px; border-radius: 8px; text-decoration: none; display: inline-block; margin-top: 16px;">Sign In / Sign Up</a>
  </div>
  
  <div id="application-form" class="card" style="display: none;">
    <div id="targeting-banner" class="targeting-banner" style="display:none"></div>
    <h1 style="margin:0 0 8px">Get a Fast-Reply Match</h1>
    <p><small>We optimize for real replies, not clicks.</small></p>
    <!-- same form as Option A, but without inline styles if you prefer -->
    <form id="fastReplyForm" action="https://formspree.io/f/xdklalra" method="POST">
      <label>Target role (free-text)
        <input name="role">
      </label>
      
      <label>Spotlight (≈4 sentences)
        <textarea name="spotlight" rows="4" required></textarea>
      </label>
      
      <label>Skills (5–10, comma-separated)
        <textarea name="skills" rows="2" required></textarea>
      </label>
      
      <label>Link 1
        <input name="link1">
      </label>
      
      <label>Link 2
        <input name="link2">
      </label>
      <input type="hidden" name="_subject">
      <input type="hidden" name="source">
      <input type="hidden" name="_redirect" value="https://guide-signal.com/thanks.html">
      <!-- UTM tracking -->
      <input type="hidden" name="utm_source">
      <input type="hidden" name="utm_medium">
      <input type="hidden" name="utm_campaign">
      <!-- Referral tracking -->
      <input type="hidden" name="ref">
      <label style="display:none">Leave this empty <input name="website"></label>
      <label><input type="checkbox" name="consent" required> I agree to the <a href="terms.html">Terms</a> and <a href="privacy.html">Privacy Policy</a>.</label>
      <button type="submit">Submit</button>
      <p id="formNote"><small>We'll email you when we've found a fast-reply match.</small></p>
    </form>
  </div>
</main>
</body>

<script type="module">
import { authFunctions, dbFunctions, utils, USER_ROLES } from './firebase-config.js';

let currentUser = null;

// Check authentication state
authFunctions.onAuthStateChanged(async (user) => {
  const authRequired = document.getElementById('auth-required');
  const applicationForm = document.getElementById('application-form');
  
  if (user) {
    currentUser = user;
    
    // Check if user is a student
    const userRole = await utils.getUserRole(user.uid);
    if (userRole !== USER_ROLES.STUDENT) {
      // Redirect non-students
      utils.showNotification('Only students can apply for jobs', 'warning');
      setTimeout(() => {
        window.location.href = '/';
      }, 2000);
      return;
    }
    
    authRequired.style.display = 'none';
    applicationForm.style.display = 'block';
    
    // Pre-fill user information
    const userData = await dbFunctions.getUserData(user.uid);
    if (userData.success) {
      // Pre-populate form with user data if available
      if (userData.data.skills && userData.data.skills.length > 0) {
        document.querySelector('textarea[name="skills"]').value = userData.data.skills.join(', ');
      }
    }
  } else {
    authRequired.style.display = 'block';
    applicationForm.style.display = 'none';
  }
});
</script>

<script>

  const f = document.getElementById('fastReplyForm');
  f.addEventListener('submit', async (e) => {
    e.preventDefault();
    
    // Check if user is authenticated
    if (!currentUser) {
      utils.showNotification('Please sign in to apply', 'error');
      return;
    }
    
    const btn = f.querySelector('button');
    btn.disabled = true; btn.textContent = 'Sending…';
    
    try {
      // Collect form data
      const formData = new FormData(f);
      const applicationData = {
        userId: currentUser.uid,
        applicantName: currentUser.displayName,
        applicantEmail: currentUser.email,
        role: formData.get('role'),
        spotlight: formData.get('spotlight'),
        skills: formData.get('skills'),
        link1: formData.get('link1'),
        link2: formData.get('link2'),
        source: formData.get('source'),
        utmSource: formData.get('utm_source'),
        utmMedium: formData.get('utm_medium'),
        utmCampaign: formData.get('utm_campaign'),
        ref: formData.get('ref')
      };
      
      // Save to Firebase first
      const firebaseResult = await dbFunctions.submitApplication(applicationData);
      
      if (!firebaseResult.success) {
        throw new Error('Failed to save application');
      }
      
      // Also submit to Formspree for backup/notification
      const res = await fetch(f.action, { method: 'POST', body: formData, headers: { 'Accept': 'application/json' }});
      
      if (res.ok || firebaseResult.success) { 
        f.innerHTML = '<h3>Thanks — you're in.</h3><p><small>We'll route your one best application ASAP.</small></p>'; 
        utils.showNotification('Application submitted successfully!', 'success');
      } else { 
        throw new Error('Submission failed');
      }
    } catch (error) {
      console.error('Application submission error:', error);
      btn.disabled = false; 
      btn.textContent = 'Submit'; 
      document.getElementById('formNote').textContent = 'Something went wrong. Please try again.';
      utils.showNotification('Failed to submit application. Please try again.', 'error');
    }
  });

  // Parse URL parameters and prefill form
  function prefillFromURL() {
    const params = new URLSearchParams(window.location.search);
    const employer = params.get('employer');
    const job = params.get('job');
    const city = params.get('city');
    const pay = params.get('pay');
    
    // Handle UTM parameters
    const utmSource = params.get('utm_source');
    const utmMedium = params.get('utm_medium');
    const utmCampaign = params.get('utm_campaign');
    const ref = params.get('ref');
    
    if (utmSource) {
      const utmSourceField = document.querySelector('input[name="utm_source"]');
      if (utmSourceField) utmSourceField.value = utmSource;
    }
    
    if (utmMedium) {
      const utmMediumField = document.querySelector('input[name="utm_medium"]');
      if (utmMediumField) utmMediumField.value = utmMedium;
    }
    
    if (utmCampaign) {
      const utmCampaignField = document.querySelector('input[name="utm_campaign"]');
      if (utmCampaignField) utmCampaignField.value = utmCampaign;
    }
    
    if (ref) {
      const refField = document.querySelector('input[name="ref"]');
      if (refField) refField.value = ref;
      
      // Show referral banner if ref parameter exists
      const banner = document.getElementById('targeting-banner');
      if (banner) {
        banner.textContent = `Referred by: ${ref}`;
        banner.style.display = 'block';
      }
    }

    if (employer && job) {
      // Show targeting banner
      const banner = document.getElementById('targeting-banner');
      banner.textContent = `Targeting: ${employer} — ${job}`;
      banner.style.display = 'block';

      // Prefill role field
      const roleSelect = document.querySelector('select[name="role"]');
      if (roleSelect) {
        // Try to find matching option or add new one
        let optionFound = false;
        for (let option of roleSelect.options) {
          if (option.value.toLowerCase().includes(job.toLowerCase()) || 
              job.toLowerCase().includes(option.value.toLowerCase())) {
            roleSelect.value = option.value;
            optionFound = true;
            break;
          }
        }
        
        // If no match found, add the job title as a new option
        if (!optionFound) {
          const newOption = document.createElement('option');
          newOption.value = job;
          newOption.textContent = job;
          newOption.selected = true;
          roleSelect.appendChild(newOption);
        }
      }

      // Add hidden inputs for tracking
      const form = document.getElementById('fastReplyForm');
      
      const hiddenInputs = [
        { name: 'target_employer', value: employer },
        { name: 'target_job_title', value: job },
        { name: 'target_job_city', value: city || '' },
        { name: 'target_pay_range', value: pay || '' }
      ];

      hiddenInputs.forEach(input => {
        const hiddenInput = document.createElement('input');
        hiddenInput.type = 'hidden';
        hiddenInput.name = input.name;
        hiddenInput.value = input.value;
        form.appendChild(hiddenInput);
      });
    }
  }

  // Run prefill when page loads
  document.addEventListener('DOMContentLoaded', prefillFromURL);
</script>