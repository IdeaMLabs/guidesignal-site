<!doctype html>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>Update Outcome - GuideSignal</title>
<style>
  body{margin:0;background:#F7F9FC;font:15px system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial,sans-serif;color:#0F172A}
  main{max-width:760px;margin:28px auto;padding:0 16px}
  .card{background:#fff;border:1px solid #e5eaf1;border-radius:16px;padding:22px;box-shadow:0 6px 20px rgba(2,8,23,.06)}
  h1{margin:0 0 8px}
  p.sub{margin:0 0 16px;color:#64748b}
  label{display:block;margin:12px 0 6px}
  input,textarea,select{width:100%;padding:12px;border-radius:10px;border:1px solid #dbe1ea;box-sizing:border-box}
  .row{display:grid;grid-template-columns:1fr 1fr;gap:12px}
  @media (max-width:640px){ .row{grid-template-columns:1fr} }
  button{margin-top:14px;padding:12px 16px;border-radius:12px;border:1px solid #0F172A;background:#0F172A;color:#fff;font-weight:700;cursor:pointer}
  small.note{color:#64748b;display:block;margin-top:10px}
  .outcome-badge{display:inline-block;padding:4px 12px;border-radius:12px;font-size:12px;font-weight:600;text-transform:uppercase;margin:4px 0}
  .outcome-interviewed{background:#17a2b8;color:white}
  .outcome-hired{background:#28a745;color:white}
  .outcome-not-a-fit{background:#6c757d;color:white}
  .error-msg{background:#f8d7da;border:1px solid #f5c6cb;color:#721c24;padding:12px;border-radius:8px;margin:12px 0;display:none}
</style>

<main>
  <div style="text-align:center;margin-bottom:20px">
    <a href="index.html" style="color:#4a9eff;text-decoration:none;margin-right:20px">← Home</a>
    <a href="jobs.html" style="color:#4a9eff;text-decoration:none;margin-right:20px">Fast-Reply Jobs</a>
    <a href="how.html" style="color:#4a9eff;text-decoration:none;margin-right:20px">How it Works</a>
    <a href="faq.html" style="color:#4a9eff;text-decoration:none">FAQ</a>
  </div>
  
  <div class="card" id="wrap">
    <h1>Update Candidate Outcome</h1>
    <p class="sub">Track interview and hiring outcomes to help improve our matching.</p>
    
    <div class="error-msg" id="error-msg">
      Invalid or missing event ID. Please use the link provided in your outreach email.
    </div>

    <form id="outcomeForm" action="https://formspree.io/f/mjkvgepg" method="POST">
      <!-- Event Information -->
      <div id="event-info" style="background:#f8f9fa;padding:12px;border-radius:8px;margin:12px 0;display:none">
        <strong>Candidate:</strong> <span id="candidate-name">-</span><br>
        <strong>Position:</strong> <span id="position-title">-</span><br>
        <strong>Company:</strong> <span id="company-name">-</span>
      </div>

      <!-- Outcome Selection -->
      <label>Outcome <span style="color:#dc3545">*</span>
        <select name="outcome" id="outcome-select" required onchange="updateOutcomeDisplay()">
          <option value="">-- Select outcome --</option>
          <option value="interviewed">Interviewed - candidate was interviewed</option>
          <option value="hired">Hired - candidate was offered and accepted position</option>
          <option value="not_a_fit">Not a fit - candidate was not selected</option>
        </select>
      </label>

      <!-- Outcome Badge Display -->
      <div style="margin:8px 0">
        <span id="outcome-badge" class="outcome-badge" style="display:none"></span>
      </div>

      <!-- When did this happen -->
      <label>When did this occur?
        <input type="date" name="when" id="when-field" max="" placeholder="YYYY-MM-DD">
        <small class="note">Optional - leave blank if you're not sure of the exact date</small>
      </label>

      <!-- Additional Notes -->
      <label>Notes (optional)
        <textarea name="notes" rows="3" placeholder="Any additional feedback about the candidate or process..."></textarea>
      </label>

      <!-- Hidden Fields -->
      <input type="hidden" name="event_id" id="event-id-field">
      <input type="hidden" name="form_type" value="outcome">
      
      <!-- Honeypot -->
      <label style="display:none">Leave this empty <input name="website"></label>

      <button type="submit" id="submit-btn">Update Outcome</button>
      <small class="note">This helps us track placement success and improve our matching algorithm.</small>
    </form>
  </div>
</main>

<script>
  // Get URL parameters
  function getURLParams() {
    const params = new URLSearchParams(window.location.search);
    return {
      event_id: params.get('e'),
      candidate: params.get('candidate'),
      position: params.get('position'),
      company: params.get('company')
    };
  }

  // Update outcome badge display
  function updateOutcomeDisplay() {
    const select = document.getElementById('outcome-select');
    const badge = document.getElementById('outcome-badge');
    const value = select.value;
    
    badge.style.display = 'none';
    badge.className = 'outcome-badge';
    
    if (value) {
      badge.style.display = 'inline-block';
      badge.className += ` outcome-${value}`;
      
      switch(value) {
        case 'interviewed':
          badge.textContent = 'Interviewed';
          break;
        case 'hired':
          badge.textContent = 'Hired';
          break;
        case 'not_a_fit':
          badge.textContent = 'Not a fit';
          break;
      }
    }
  }

  // Initialize page
  document.addEventListener('DOMContentLoaded', () => {
    const params = getURLParams();
    
    // Set max date to today
    const today = new Date().toISOString().split('T')[0];
    document.getElementById('when-field').max = today;
    
    // Check for event_id
    if (!params.event_id) {
      document.getElementById('error-msg').style.display = 'block';
      document.getElementById('outcomeForm').style.display = 'none';
      return;
    }
    
    // Set event_id
    document.getElementById('event-id-field').value = params.event_id;
    
    // Show event info if provided
    if (params.candidate || params.position || params.company) {
      const eventInfo = document.getElementById('event-info');
      eventInfo.style.display = 'block';
      
      if (params.candidate) {
        document.getElementById('candidate-name').textContent = decodeURIComponent(params.candidate);
      }
      if (params.position) {
        document.getElementById('position-title').textContent = decodeURIComponent(params.position);
      }
      if (params.company) {
        document.getElementById('company-name').textContent = decodeURIComponent(params.company);
      }
    }
  });

  // Form submission
  const form = document.getElementById('outcomeForm');
  form.addEventListener('submit', async (e) => {
    e.preventDefault();
    const btn = document.getElementById('submit-btn');
    
    btn.disabled = true;
    btn.textContent = 'Submitting...';
    
    try {
      const res = await fetch(form.action, {
        method: 'POST',
        body: new FormData(form),
        headers: { 'Accept': 'application/json' }
      });
      
      if (res.ok) {
        const outcome = document.getElementById('outcome-select').value;
        let outcomeText = 'outcome';
        
        switch(outcome) {
          case 'interviewed': outcomeText = 'interview'; break;
          case 'hired': outcomeText = 'hire'; break;
          case 'not_a_fit': outcomeText = 'not a fit'; break;
        }
        
        document.getElementById('wrap').innerHTML = `
          <h2>Outcome Updated Successfully</h2>
          <p class="sub">
            Thank you for updating the candidate outcome to: <strong>${outcomeText}</strong>
          </p>
          <p style="margin-top: 20px;">
            This information helps us improve our matching and track placement success.
          </p>
          <p style="margin-top: 20px;">
            <a href="index.html" style="color: #4a9eff;">← Back to GuideSignal</a>
          </p>
        `;
      } else {
        throw new Error('Submission failed');
      }
    } catch (err) {
      btn.disabled = false;
      btn.textContent = 'Update Outcome';
      alert('Network error. Please try again.');
    }
  });
</script>