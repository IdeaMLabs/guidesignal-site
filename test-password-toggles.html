<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Password Toggle Test</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            background: #f5f5f5;
        }
        .test-container {
            background: white;
            padding: 30px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            margin-bottom: 20px;
        }
        .password-container {
            position: relative;
            margin-bottom: 20px;
        }
        .form-input {
            width: 100%;
            padding: 12px 45px 12px 12px;
            border: 2px solid #d1d5db;
            border-radius: 6px;
            font-size: 16px;
        }
        .password-toggle {
            position: absolute;
            right: 12px;
            top: 50%;
            transform: translateY(-50%);
            background: none;
            border: none;
            cursor: pointer;
            font-size: 18px;
            z-index: 10;
            display: flex;
            align-items: center;
            justify-content: center;
            min-width: 24px;
            min-height: 24px;
        }
        .test-result {
            padding: 15px;
            margin: 10px 0;
            border-radius: 6px;
        }
        .success { background: #d1fae5; border-left: 4px solid #10b981; }
        .error { background: #fee2e2; border-left: 4px solid #ef4444; }
        .info { background: #dbeafe; border-left: 4px solid #3b82f6; }
        button {
            background: #4a9eff;
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 6px;
            cursor: pointer;
            margin: 5px;
            font-size: 16px;
        }
        button:hover { background: #3b82f6; }
        label {
            display: block;
            margin-bottom: 5px;
            font-weight: 600;
        }
    </style>
</head>
<body>
    <div class="test-container">
        <h1>üîê Password Toggle Test</h1>
        <p>Testing the password toggle fix implementation according to the instructions.</p>

        <h3>Test Fields:</h3>

        <label>Test Password Field 1:</label>
        <div class="password-container">
            <input type="password" class="form-input" id="test-password-1" value="TestPassword123!" placeholder="Test password field">
            <button type="button" class="password-toggle">üëÅÔ∏è</button>
        </div>

        <label>Test Password Field 2 (Confirm):</label>
        <div class="password-container">
            <input type="password" class="form-input" id="test-password-2" value="ConfirmPassword456!" placeholder="Confirm password field">
            <button type="button" class="password-toggle">üëÅÔ∏è</button>
        </div>

        <div class="controls">
            <button onclick="runPasswordToggleTests()">üß™ Run Password Toggle Tests</button>
            <button onclick="initializePasswordToggles()">üîß Initialize Toggles</button>
            <button onclick="clearResults()">üßπ Clear Results</button>
        </div>

        <div id="test-results"></div>
    </div>

    <iframe src="auth.html" width="100%" height="600" style="border: 1px solid #ccc; margin-top: 20px;"></iframe>

    <script>
        let testResults = [];

        // Implementation from passwordToggleFix.js
        function togglePassword(inputId) {
            var input = document.getElementById(inputId);
            var toggle = input.parentElement.querySelector('.password-toggle');

            if (input.type === 'password') {
                input.type = 'text';
                toggle.textContent = 'üôà';
            } else {
                input.type = 'password';
                toggle.textContent = 'üëÅÔ∏è';
            }
        }

        function initializePasswordToggles() {
            logResult('üîß Initializing password toggles...', 'info');

            var containers = document.querySelectorAll('.password-container');

            containers.forEach(function(container) {
                var input = container.querySelector('input');
                var toggle = container.querySelector('.password-toggle');

                if (input && toggle) {
                    // Remove existing listeners
                    toggle.replaceWith(toggle.cloneNode(true));
                    toggle = container.querySelector('.password-toggle');

                    toggle.addEventListener('click', function() {
                        if (input.type === 'password') {
                            input.type = 'text';
                            toggle.textContent = 'üôà';
                            toggle.setAttribute('aria-label', 'Hide password');
                        } else {
                            input.type = 'password';
                            toggle.textContent = 'üëÅÔ∏è';
                            toggle.setAttribute('aria-label', 'Show password');
                        }
                        logResult(`‚úÖ Password toggle activated for ${input.id}`, 'success');
                    });

                    logResult(`‚úÖ Password toggle initialized for ${input.id}`, 'success');
                }
            });
        }

        function logResult(message, type = 'info') {
            testResults.push({ message, type, timestamp: new Date().toLocaleTimeString() });
            updateResults();
        }

        function updateResults() {
            const resultsDiv = document.getElementById('test-results');
            const html = testResults.map(result =>
                `<div class="test-result ${result.type}">[${result.timestamp}] ${result.message}</div>`
            ).join('');
            resultsDiv.innerHTML = html;
        }

        function clearResults() {
            testResults = [];
            updateResults();
        }

        function runPasswordToggleTests() {
            clearResults();
            logResult('üß™ Starting Password Toggle Tests...', 'info');

            // Test 1: Check if containers exist
            const containers = document.querySelectorAll('.password-container');
            logResult(`Found ${containers.length} password containers`, containers.length > 0 ? 'success' : 'error');

            // Test 2: Check if inputs exist
            containers.forEach((container, index) => {
                const input = container.querySelector('input');
                const toggle = container.querySelector('.password-toggle');

                if (input && toggle) {
                    logResult(`‚úÖ Container ${index + 1}: Input and toggle found (${input.id})`, 'success');

                    // Test toggle functionality
                    const originalType = input.type;
                    toggle.click();

                    setTimeout(() => {
                        const newType = input.type;
                        if (originalType !== newType) {
                            logResult(`‚úÖ Container ${index + 1}: Toggle working (${originalType} ‚Üí ${newType})`, 'success');
                        } else {
                            logResult(`‚ùå Container ${index + 1}: Toggle not working`, 'error');
                        }

                        // Reset to original state
                        if (input.type !== originalType) {
                            toggle.click();
                        }
                    }, 100);
                } else {
                    logResult(`‚ùå Container ${index + 1}: Missing input or toggle`, 'error');
                }
            });

            // Test 3: Check for both fields
            const field1 = document.getElementById('test-password-1');
            const field2 = document.getElementById('test-password-2');

            if (field1 && field2) {
                logResult('‚úÖ Both test password fields found', 'success');
            } else {
                logResult('‚ùå Test password fields missing', 'error');
            }

            logResult('üéâ Password toggle tests completed!', 'info');
        }

        // Initialize on page load
        window.addEventListener('load', function() {
            initializePasswordToggles();
            setTimeout(() => {
                logResult('üöÄ Password toggle test page loaded', 'success');
                logResult('Click "Run Password Toggle Tests" to validate functionality', 'info');
            }, 500);
        });
    </script>
</body>
</html>